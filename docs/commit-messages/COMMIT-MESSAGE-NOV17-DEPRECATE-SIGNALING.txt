# Architecture Cleanup: Remove Deprecated P2P Signaling Service

## Summary
Removed deprecated `signaling` service (P2P Socket.IO) from production stack.
Phase 5 complete with Gateway SFU working perfectly, P2P signaling no longer needed.

## Changes Made

### Infrastructure (stack-hybrid.yml)
- ✅ Removed `signaling` service (jackboun11/jbcalling-signaling:2.5.3)
- ✅ Updated stack header to reflect Phase 5 completion
- ✅ Added deprecation comments and rollback instructions
- ✅ Created backup: stack-hybrid-with-signaling.yml.backup

### Documentation
- ✅ Created docs/reports/DEPRECATED-SERVICES-NOV17.md
  - Comprehensive deprecation documentation
  - Rollback procedures
  - Architecture comparison (P2P vs SFU)
  - Migration paths
  
- ✅ Updated README.md
  - Service count: 14 → 13
  - Added architecture simplified note
  
- ✅ Updated DOCUMENTATION-INDEX.md (partial)
  - Added deprecation section
  - Updated service count

### Services Count
- Before: 14 services (with signaling)
- After: 13 services (consolidated)
- Resource savings: ~1.5GB RAM (3 signaling replicas)

## Reason for Removal

### P2P Signaling (signaling service)
- ❌ Architecture mismatch with SFU approach
- ❌ Not used since Frontend 1.0.34 (Nov 17)
- ❌ Duplicate Socket.IO logic with Gateway
- ❌ Resource waste (3 replicas @ 512MB each)
- ✅ Replaced by: Gateway service (unified Socket.IO + MediaSoup)

### Separate MediaSoup Workers (already removed Nov 10)
- ❌ RTP capabilities mismatch
- ❌ Cross-service communication overhead
- ✅ Replaced by: MediaSoup workers integrated in Gateway

## Current Architecture (Simplified)

```
Frontend (React + MediaSoup Client)
  ↓ Socket.IO WSS
Gateway (NodeJS + Socket.IO + MediaSoup SFU)
  ↓ RTP/SRTP UDP
MediaSoup Workers (integrated)
  ↓ ICE/TURN fallback
Coturn (TURN server)
```

## Benefits
1. ✅ Simpler architecture (fewer moving parts)
2. ✅ Easier maintenance (single video call service)
3. ✅ Lower resource usage (~1.5GB RAM freed)
4. ✅ No cross-service communication overhead
5. ✅ Prepared for Phase 6 (Translation Pipeline)

## Rollback Plan
If Gateway SFU issues found:
1. Use backup: stack-hybrid-with-signaling.yml.backup
2. Update Frontend env: REACT_APP_SIGNALING_URL
3. Deploy and verify
4. See docs/reports/DEPRECATED-SERVICES-NOV17.md for details

## Testing Checklist
- [ ] Deploy updated stack: `docker stack deploy -c stack-hybrid.yml translation`
- [ ] Verify service count: `docker service ls` (should show 13)
- [ ] Verify no signaling service: `docker service ls | grep signaling` (empty)
- [ ] Test video call: https://jbcalling.site
- [ ] Verify Gateway health: curl https://webrtc.jbcalling.site/health
- [ ] Check Gateway logs: No errors
- [ ] Monitor resource usage: Should decrease ~1.5GB

## Related
- Phase: 5 (MediaSoup SFU Complete)
- Frontend: v1.0.43 (Full SFU implementation)
- Gateway: v1.0.7 (CORS fix + IPv6)
- Wrap-up: docs/wrap-ups/WRAP-UP-NOV17-MEDIASOUP-SFU-COMPLETE.md
- Deprecation doc: docs/reports/DEPRECATED-SERVICES-NOV17.md

## Next Phase
Phase 6: Translation Pipeline Integration
- No signaling service conflicts
- Clean architecture for AI integration
- Gateway handles all WebRTC + translation coordination

---
Date: November 17, 2025
Phase: 5 Complete → Ready for Phase 6
Status: ✅ Architecture simplified, production-ready
