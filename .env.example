# =========# ================# =============================================================================
# ‚ö†Ô∏è C·∫¨P NH·∫¨T QUAN TR·ªåNG - THAY ƒê·ªîI C·∫§U H√åNH INSTANCES
# =============================================================================
#
# C·∫•u h√¨nh th·ª±c t·∫ø (Oct 4, 2025):
#   - translation01: c4d-standard-4 (4 vCPU, 15GB RAM) - GI·∫¢M t·ª´ 8 vCPU
#   - translation02: c2d-standard-4 (4 vCPU, 16GB RAM) - GI·∫¢M t·ª´ 8 vCPU  
#   - translation03: c2d-highcpu-4 (4 vCPU, 8GB RAM) - GI·ªÆ NGUY√äN
#
# ‚ö†Ô∏è IMPACT:
#   - Concurrent rooms: 1-2 (thay v√¨ 3-5)
#   - MediaSoup workers: 2 (thay v√¨ 6)
#   - STT/Translation: Slower (~2x latency)
#   - RAM translation01: CH·ªà 2GB overhead (risk OOM)
#
# üí° KHUY·∫æN NGH·ªä:
#   - MVP: 1 room ƒë·ªìng th·ªùi, 4-6 users
#   - Monitor RAM s√°t tr√™n translation01
#   - C√¢n nh·∫Øc upgrade l√™n 8 vCPU n·∫øu c·∫ßn scale
#
# =============================================================================

# =============================================================================
# 1. INFRASTRUCTURE - INSTANCE IPs================================================
# 1. INFRASTRUCTURE - INSTANCE IPs
# =============================================================================
# IP addresses c·ªßa 3 Google Cloud instances

# Instance 1: Manager + AI Processing
# Machine: c4d-standard-4 (4 vCPUs, 15 GB RAM)
# Location: asia-southeast1-a
# Internal IP: 10.148.0.5
INSTANCE_01_IP=35.198.221.169
INSTANCE_01_INTERNAL_IP=10.148.0.5
INSTANCE_01_HOSTNAME=translation01
INSTANCE_01_ZONE=asia-southeast1-a

# Instance 2: Worker + WebRTC Gateway
# Machine: c2d-standard-4 (4 vCPUs, 16 GB RAM)
# Location: asia-southeast1-b
# Internal IP: 10.148.0.3
INSTANCE_02_IP=34.126.152.20
INSTANCE_02_INTERNAL_IP=10.148.0.3
INSTANCE_02_HOSTNAME=translation02
INSTANCE_02_ZONE=asia-southeast1-b

# Instance 3: Worker + Monitoring
# Machine: c2d-highcpu-4 (4 vCPUs, 8 GB RAM)
# Location: asia-southeast1-c (assumed)
INSTANCE_03_IP=34.158.47.145         # ‚ö†Ô∏è C·∫¶N ƒêI·ªÄN: External IP c·ªßa translation03
INSTANCE_03_INTERNAL_IP= 10.148.0.4 # ‚ö†Ô∏è C·∫¶N ƒêI·ªÄN: Internal IP (10.148.0.x)
INSTANCE_03_HOSTNAME=translation03
INSTANCE_03_ZONE= asia-southeast1-b       # VD: asia-southeast1-c====================================================
# JB CALLING - REAL-TIME TRANSLATION SYSTEM
# Environment Configuration Template
# =============================================================================
# ‚ö†Ô∏è QUAN TR·ªåNG: Copy file n√†y th√†nh `.env` v√† ƒëi·ªÅn th√¥ng tin th·ª±c
# ‚ö†Ô∏è KH√îNG commit file `.env` v√†o git (ƒë√£ c√≥ trong .gitignore)
# 
# Version: 2.0
# Last Updated: 2025-01-04
# =============================================================================

# =============================================================================
# 1. INFRASTRUCTURE - INSTANCE IPs
# =============================================================================
# IP addresses c·ªßa 3 Google Cloud instances

# Instance 1: Manager + AI Processing (c2d-highcpu-8, 16GB RAM)
INSTANCE_01_IP= 35.198.221.169         # VD: 34.123.45.67
INSTANCE_01_HOSTNAME=translation01

# Instance 2: Worker + WebRTC Gateway (c2d-highcpu-8, 16GB RAM)
INSTANCE_02_IP= 34.126.152.20        # VD: 35.234.56.78
INSTANCE_02_HOSTNAME=translation02

# Instance 3: Worker + Monitoring (c2d-highcpu-4, 8GB RAM)
INSTANCE_03_IP= 34.158.47.145         # VD: 36.345.67.89
INSTANCE_03_HOSTNAME=translation03

# Docker Swarm Manager IP (th∆∞·ªùng l√† INSTANCE_01_IP)
SWARM_MANAGER_IP=${INSTANCE_01_IP}

# =============================================================================
# 2. DOMAIN & SSL
# =============================================================================
# Domain names cho services (optional cho MVP, b·∫Øt bu·ªôc cho production)

# Main domain
DOMAIN_NAME=jbcalling.site             # VD: jbcalling.com (ƒë·ªÉ tr·ªëng n·∫øu d√πng IP)

# API subdomain
API_DOMAIN=              # VD: api.jbcalling.com
# WebRTC subdomain
WEBRTC_DOMAIN=           # VD: webrtc.jbcalling.com
# Monitoring subdomain
MONITORING_DOMAIN=       # VD: monitoring.jbcalling.com

# SSL Certificate paths (ƒë·ªÉ tr·ªëng n·∫øu d√πng self-signed ho·∫∑c Let's Encrypt auto)
SSL_CERT_PATH=           # VD: /etc/letsencrypt/live/jbcalling.com/fullchain.pem
SSL_KEY_PATH=            # VD: /etc/letsencrypt/live/jbcalling.com/privkey.pem

# Let's Encrypt email (cho auto SSL)
LETSENCRYPT_EMAIL=hopboy2003@gmail.com       # VD: admin@jbcalling.com

# =============================================================================
# 3. DATABASE - PostgreSQL
# =============================================================================
# PostgreSQL configuration

POSTGRES_VERSION=15
POSTGRES_HOST=postgres   # Service name trong Docker Swarm
POSTGRES_PORT=5432
POSTGRES_DB=jbcalling_db
POSTGRES_USER=jbcalling
POSTGRES_PASSWORD=3010@jEnny1123911576456       # ‚ö†Ô∏è B·∫ÆT BU·ªòC: M·∫≠t kh·∫©u m·∫°nh (min 16 k√Ω t·ª±)

# PostgreSQL connection string (t·ª± ƒë·ªông generate t·ª´ tr√™n)
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# Pool settings
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=40

# =============================================================================
# 4. REDIS - Cache & Queue
# =============================================================================
# Redis configuration

REDIS_VERSION=7-alpine
REDIS_HOST=redis         # Service name trong Docker Swarm
REDIS_PORT=6379
REDIS_PASSWORD=3010@jEnny1123911576456          # ‚ö†Ô∏è B·∫ÆT BU·ªòC: M·∫≠t kh·∫©u m·∫°nh

# Redis URLs
REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/0
REDIS_CACHE_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/1
REDIS_CELERY_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/2

# Redis memory limit
REDIS_MAXMEMORY=2gb
REDIS_MAXMEMORY_POLICY=allkeys-lru

# =============================================================================
# 5. SECURITY - JWT & Secrets
# =============================================================================
# Security keys v√† tokens

# JWT Secret Key (generate: openssl rand -hex 32)
JWT_SECRET_KEY=          # ‚ö†Ô∏è B·∫ÆT BU·ªòC: 64 k√Ω t·ª± hex

# JWT Settings
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# Session secret (generate: openssl rand -hex 32)
SESSION_SECRET_KEY=      # ‚ö†Ô∏è B·∫ÆT BU·ªòC: 64 k√Ω t·ª± hex

# Encryption key cho sensitive data (generate: openssl rand -hex 32)
ENCRYPTION_KEY=          # ‚ö†Ô∏è B·∫ÆT BU·ªòC: 64 k√Ω t·ª± hex

# =============================================================================
# 6. AI MODELS - Hugging Face
# =============================================================================
# Hugging Face configuration

# Hugging Face API Token (l·∫•y t·ª´: https://huggingface.co/settings/tokens)
HF_TOKEN=your_huggingface_token_here                # ‚ö†Ô∏è B·∫ÆT BU·ªòC: Token ƒë·ªÉ download models
HF_HOME=/app/models      # Th∆∞ m·ª•c l∆∞u models

# Model versions
WHISPER_MODEL=small      # Options: tiny, base, small, medium (kh√¥ng d√πng large - qu√° n·∫∑ng)
WHISPER_DEVICE=cpu
WHISPER_COMPUTE_TYPE=int8

# PhoWhisper cho ti·∫øng Vi·ªát (Pro tier)
PHOWHISPER_ENABLED=false
PHOWHISPER_MODEL=vinai/PhoWhisper-large

# NLLB Translation
NLLB_MODEL=facebook/nllb-200-distilled-600M
NLLB_DEVICE=cpu

# XTTS Voice Cloning (Premium tier)
XTTS_MODEL=tts_models/multilingual/multi-dataset/xtts_v2
XTTS_DEVICE=cpu
XTTS_ENABLED=true

# PyAnnote Diarization (Pro tier)
PYANNOTE_ENABLED=false
PYANNOTE_MODEL=pyannote/speaker-diarization-3.1
PYANNOTE_TOKEN=${HF_TOKEN}  # C·∫ßn accept user agreement tr√™n HF

# =============================================================================
# 7. WEBRTC - MediaSoup
# =============================================================================
# MediaSoup configuration

MEDIASOUP_LISTEN_IP=0.0.0.0
MEDIASOUP_ANNOUNCED_IP=${INSTANCE_02_IP}  # Public IP c·ªßa instance 2

# RTC ports (m·ªü firewall cho range n√†y)
MEDIASOUP_RTC_MIN_PORT=40000
MEDIASOUP_RTC_MAX_PORT=49999

# Workers (‚ö†Ô∏è ADJUSTED: 4 vCPU ‚Üí 2 workers, gi·ªØ 2 cores cho OS)
MEDIASOUP_NUM_WORKERS=2

# =============================================================================
# 8. WEBRTC - STUN/TURN Server
# =============================================================================
# Coturn configuration (b·∫Øt bu·ªôc cho production)

# Coturn enabled (set true khi deploy production)
TURN_ENABLED=false       # Set true khi c√≥ TURN server

# STUN server (public, free)
STUN_SERVER=stun:stun.l.google.com:19302

# TURN server configuration
TURN_SERVER_URL=         # VD: turn:turn.jbcalling.com:3478
TURN_USERNAME=           # Username cho TURN authentication
TURN_PASSWORD=           # ‚ö†Ô∏è B·∫ÆT BU·ªòC n·∫øu TURN_ENABLED=true

# Coturn settings (n·∫øu self-hosted)
COTURN_REALM=jbcalling.com
COTURN_SECRET=           # ‚ö†Ô∏è B·∫ÆT BU·ªòC: Static secret cho TURN
COTURN_MIN_PORT=49152
COTURN_MAX_PORT=65535

# =============================================================================
# 9. APPLICATION - FastAPI Backend
# =============================================================================
# FastAPI configuration

APP_NAME=JB Calling
APP_VERSION=2.0.0
APP_ENV=development      # Options: development, staging, production

# API settings
API_HOST=0.0.0.0
API_PORT=8000
API_PREFIX=/api/v1
API_DOCS_ENABLED=true    # Set false trong production

# CORS settings (c·∫≠p nh·∫≠t v·ªõi domain th·ª±c)
CORS_ORIGINS=["http://localhost:3000","http://localhost:8000"]  # Th√™m domain production

# Rate limiting
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_BURST=10

# =============================================================================
# 10. APPLICATION - Frontend
# =============================================================================
# Next.js/React frontend

NEXT_PUBLIC_API_URL=http://${API_DOMAIN:-localhost:8000}${API_PREFIX}
NEXT_PUBLIC_WS_URL=ws://${API_DOMAIN:-localhost:8000}/ws
NEXT_PUBLIC_WEBRTC_URL=https://${WEBRTC_DOMAIN:-localhost:3001}

# =============================================================================
# 11. BACKGROUND JOBS - Celery
# =============================================================================
# Celery configuration

CELERY_BROKER_URL=${REDIS_CELERY_URL}
CELERY_RESULT_BACKEND=${REDIS_CELERY_URL}
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=["json"]
CELERY_TIMEZONE=Asia/Ho_Chi_Minh

# Worker settings
CELERY_WORKER_CONCURRENCY=4
CELERY_WORKER_MAX_TASKS_PER_CHILD=100

# =============================================================================
# 12. MONITORING - Prometheus & Grafana
# =============================================================================
# Monitoring stack

# Prometheus
PROMETHEUS_RETENTION_TIME=15d
PROMETHEUS_PORT=9090

# Grafana
GRAFANA_PORT=3000
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=3010  # ‚ö†Ô∏è B·∫ÆT BU·ªòC: M·∫≠t kh·∫©u admin Grafana

# Grafana SMTP (cho alerting)
GRAFANA_SMTP_ENABLED=false
GRAFANA_SMTP_HOST=
GRAFANA_SMTP_PORT=587
GRAFANA_SMTP_USER=
GRAFANA_SMTP_PASSWORD=
GRAFANA_SMTP_FROM_ADDRESS=monitoring@jbcalling.com

# =============================================================================
# 13. LOGGING - Loki (thay ELK ƒë·ªÉ nh·∫π h∆°n)
# =============================================================================
# Loki + Promtail configuration (nh·∫π h∆°n ELK cho 8GB RAM)

LOKI_ENABLED=true
LOKI_PORT=3100
LOKI_RETENTION_DAYS=7

# =============================================================================
# 14. EMAIL - SMTP (cho notifications)
# =============================================================================
# Email configuration (optional cho MVP)

SMTP_ENABLED=false
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM_EMAIL=noreply@jbcalling.com
SMTP_FROM_NAME=JB Calling

# =============================================================================
# 15. STORAGE - Object Storage (optional)
# =============================================================================
# S3-compatible storage cho recordings, voice samples

S3_ENABLED=false
S3_ENDPOINT=             # VD: https://s3.amazonaws.com
S3_BUCKET=jbcalling-media
S3_ACCESS_KEY=
S3_SECRET_KEY=
S3_REGION=ap-southeast-1

# =============================================================================
# 16. FEATURE FLAGS - Tiered Features
# =============================================================================
# Enable/disable features theo tier

# Free tier (default)
FEATURE_TEXT_CAPTIONS=true
FEATURE_GTTS_AUDIO=true

# Premium tier
FEATURE_VOICE_CLONING=true
FEATURE_XTTS_ASYNC=true

# Pro tier
FEATURE_DIARIZATION=false     # Set true khi c√≥ ƒë·ªß resource
FEATURE_PHOWHISPER=false

# Enterprise tier
FEATURE_CUSTOM_MODELS=false
FEATURE_ON_PREMISE=false

# =============================================================================
# 17. PERFORMANCE - Tuning
# =============================================================================
# Performance settings (‚ö†Ô∏è ADJUSTED for 4 vCPU instances)

# STT settings (‚ö†Ô∏è Gi·∫£m concurrent processing)
STT_CHUNK_DURATION=5     # seconds (kh√¥ng d√πng 30s)
STT_VAD_THRESHOLD=0.5
STT_BATCH_SIZE=1         # Process 1 chunk at a time (low latency)
STT_MAX_CONCURRENT=2     # ‚ö†Ô∏è Max 2 concurrent STT jobs (4 vCPU limit)

# Translation settings (‚ö†Ô∏è Gi·∫£m batch size)
TRANSLATION_BATCH_SIZE=1  # ‚ö†Ô∏è Reduced from 2
TRANSLATION_CACHE_TTL=3600
TRANSLATION_MAX_CONCURRENT=2

# TTS settings
TTS_CACHE_TTL=86400
TTS_QUICK_TIMEOUT=5      # gTTS timeout
TTS_CLONE_TIMEOUT=120    # XTTS timeout

# Celery workers (‚ö†Ô∏è ADJUSTED for 4 vCPU)
CELERY_WORKER_CONCURRENCY=2  # ‚ö†Ô∏è Reduced from 4

# =============================================================================
# 18. DEVELOPMENT - Debug Settings
# =============================================================================
# Development only (set false trong production)

DEBUG=false
LOG_LEVEL=INFO           # Options: DEBUG, INFO, WARNING, ERROR
VERBOSE_LOGGING=false

# Testing
TESTING=false
TEST_DATABASE_URL=postgresql://test:test@localhost:5433/test_db

# =============================================================================
# 19. DEPLOYMENT - Docker Settings
# =============================================================================
# Docker/Swarm settings

COMPOSE_PROJECT_NAME=jbcalling
DOCKER_REGISTRY=         # VD: registry.jbcalling.com (n·∫øu d√πng private registry)

# Resource limits (adjust theo instance)
DEFAULT_CPU_LIMIT=1.0
DEFAULT_MEMORY_LIMIT=1g

# =============================================================================
# 20. BACKUP - Database Backup
# =============================================================================
# Backup configuration

BACKUP_ENABLED=false
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM
BACKUP_RETENTION_DAYS=7
BACKUP_S3_BUCKET=jbcalling-backups

# =============================================================================
# C√ÅC L·ªÜNH H·ªÆU √çCH
# =============================================================================
#
# 1. Generate JWT secret:
#    openssl rand -hex 32
#
# 2. Generate encryption key:
#    openssl rand -hex 32
#
# 3. Generate TURN secret:
#    openssl rand -base64 32
#
# 4. Test database connection:
#    docker exec -it <postgres-container> psql -U $POSTGRES_USER -d $POSTGRES_DB
#
# 5. Test Redis connection:
#    docker exec -it <redis-container> redis-cli -a $REDIS_PASSWORD ping
#
# 6. View logs:
#    docker service logs -f <service-name>
#
# 7. Check service status:
#    docker service ps <service-name>
#
# =============================================================================
# L∆ØU √ù QUAN TR·ªåNG
# =============================================================================
#
# ‚ö†Ô∏è C√ÅC TR∆Ø·ªúNG B·∫ÆT BU·ªòC PH·∫¢I ƒêI·ªÄN:
#    - INSTANCE_*_IP (3 IPs)
#    - POSTGRES_PASSWORD
#    - REDIS_PASSWORD
#    - JWT_SECRET_KEY
#    - SESSION_SECRET_KEY
#    - ENCRYPTION_KEY
#    - HF_TOKEN
#    - GRAFANA_ADMIN_PASSWORD
#
# ‚ö†Ô∏è PRODUCTION CHECKLIST:
#    - [ ] ƒê·ªïi APP_ENV=production
#    - [ ] Set DEBUG=false
#    - [ ] Set API_DOCS_ENABLED=false
#    - [ ] C·∫≠p nh·∫≠t CORS_ORIGINS v·ªõi domain th·ª±c
#    - [ ] Enable TURN_ENABLED=true v√† c·∫•u h√¨nh TURN
#    - [ ] Setup SSL certificates
#    - [ ] Enable backups
#    - [ ] Configure SMTP cho alerts
#    - [ ] Set strong passwords (min 16 chars, mixed)
#
# ‚ö†Ô∏è SECURITY:
#    - KH√îNG commit file .env v√†o git
#    - KH√îNG share credentials qua email/chat
#    - KH√îNG log sensitive values
#    - Rotate secrets ƒë·ªãnh k·ª≥ (3-6 th√°ng)
#    - Use Docker secrets cho production
#
# =============================================================================
